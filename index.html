<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>To-Do List</title>
    
    <!-- APP LOGO SETUP -->
    <!-- Save your purple neon image as "logo.jpg" in the same folder as this file -->
    <link rel="icon" type="image/jpeg" href="logo.jpg">
    <link rel="apple-touch-icon" href="logo.jpg">

    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #ffffff;
            --accent: #bb86fc;
            --success: #03dac6;
            --error: #cf6679;
            --warning: #ffb74d;
            --heavy-glow: rgba(88, 86, 214, 0);
        }

        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background-color 0.8s ease;
        }

        /* The heavy load glow container */
        .bottom-glow {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background: linear-gradient(to top, var(--heavy-glow), transparent);
            pointer-events: none;
            z-index: 5;
            transition: all 0.5s ease;
        }

        h1 { margin-bottom: 20px; font-weight: 300; letter-spacing: 2px; }

        /* --- Floating Action Button (FAB) --- */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: var(--accent);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            font-weight: bold;
            color: black;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s;
            border: none;
        }
        .fab:active { transform: scale(0.9); }

        /* --- Popup Input Section --- */
        .popup-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: flex-end; 
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .controls {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .popup-active .popup-overlay { display: flex; opacity: 1; }
        .popup-active .controls { transform: translateY(0); }

        .close-popup {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: auto;
        }

        input[type="text"], input[type="date"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background: #2c2c2c;
            border: 1px solid #444;
            color: white;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }
        
        input[type="date"] {
            -webkit-appearance: none;
            appearance: none;
            min-height: 45px; 
        }

        label { display: block; margin-bottom: 5px; font-size: 0.9em; color: #aaa; }
        
        .slider-container { margin-bottom: 15px; }
        
        input[type="range"] {
            width: 100%;
            accent-color: var(--accent);
            height: 6px;
            background: #444;
            border-radius: 5px;
            outline: none;
            cursor: pointer;
        }

        button.add-btn {
            width: 100%;
            padding: 15px;
            background-color: var(--accent);
            color: black;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
        }

        /* --- List Section --- */
        #todo-list {
            width: 100%;
            max-width: 500px;
            list-style: none;
            padding: 0;
            padding-bottom: 100px; 
            position: relative;
            z-index: 10;
        }

        .todo-item {
            background: var(--card-bg);
            margin-bottom: 15px;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 5px solid var(--accent);
        }

        .todo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .todo-title { 
            font-weight: bold; 
            word-break: break-word; 
            flex-grow: 1;
            padding-right: 10px;
        }
        
        .todo-date { 
            color: white; 
            white-space: nowrap; 
            margin-left: 10px; 
            background: rgba(255,255,255,0.1);
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: bold;
            position: relative; 
            display: inline-block; 
        }
        
        .todo-date:active {
            background: rgba(255,255,255,0.3);
        }

        /* --- DATE INPUT FIX --- */
        /* Forces the calendar picker indicator to fill the entire input area */
        .date-input-overlay {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            opacity: 0; 
            z-index: 10; 
            cursor: pointer; 
            border: none; 
            padding: 0; 
            margin: 0;
        }

        .date-input-overlay::-webkit-calendar-picker-indicator {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            cursor: pointer;
        }

        /* Dynamic Sizing Classes */
        .size-1 { transform: scale(0.95); opacity: 0.9; }
        .size-2 { transform: scale(1); }
        .size-3 { transform: scale(1.02); font-size: 1.05em; border-left-width: 8px; }
        .size-4 { transform: scale(1.05); font-size: 1.1em; border-left-width: 10px; }
        .size-5 { transform: scale(1.08); font-size: 1.2em; border-left-width: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.6); font-weight: bold; }

        /* Progress Slider */
        .progress-wrapper {
            margin-top: 15px;
        }
        .progress-label {
            font-size: 0.7em;
            text-align: right;
            margin-bottom: 2px;
            color: #888;
        }
        .progress-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 10px;
            background: #333;
            border-radius: 5px;
            outline: none;
        }
        .progress-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--text-color);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transition: transform 0.1s;
        }
        .progress-slider::-webkit-slider-thumb:active { transform: scale(1.2); }

        /* --- Animations --- */
        @keyframes successPop {
            0% { transform: scale(1); background-color: var(--success); }
            50% { transform: scale(1.1); box-shadow: 0 0 30px var(--success); }
            100% { transform: scale(0); opacity: 0; margin: 0; padding: 0; height: 0; }
        }

        .completed-anim {
            animation: successPop 0.8s forwards ease-in-out;
            pointer-events: none;
            background-color: var(--success) !important;
            color: black;
            border: none;
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: fall linear forwards;
            z-index: 2000;
            pointer-events: none;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        /* Firework Particles */
        .firework-particle {
            position: fixed;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            z-index: 2001;
            pointer-events: none;
            animation: fireworkFly 1s ease-out forwards;
            box-shadow: 0 0 8px currentColor;
        }
        
        @keyframes fireworkFly {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(0.5); opacity: 0; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            color: #555;
            margin-top: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        .empty-state img {
            max-width: 90%;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            width: 350px;
        }
        .empty-state p {
            font-size: 1.2em;
            color: var(--success);
            font-weight: 300;
        }

    </style>
</head>
<body>

    <h1>To-Do List</h1>

    <!-- Glow Effect for heavy load -->
    <div id="bottomGlow" class="bottom-glow"></div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="togglePopup()">+</button>

    <!-- Popup Input Form -->
    <div class="popup-overlay" id="popupOverlay" onclick="if(event.target === this) togglePopup()">
        <div class="controls">
            <button class="close-popup" onclick="togglePopup()">Ã—</button>
            <h2 style="margin-top:0; font-weight:300;">New Task</h2>
            
            <label>Task Description</label>
            <input type="text" id="taskInput" placeholder="What needs doing?">

            <label>Due Date</label>
            <input type="date" id="dateInput">

            <div class="slider-container">
                <label>Assignment Size (1-5): <span id="sizeVal" style="color:var(--accent); font-weight:bold;">1</span></label>
                <input type="range" id="sizeInput" min="1" max="5" value="1" oninput="document.getElementById('sizeVal').innerText = this.value">
            </div>

            <button class="add-btn" onclick="addTask()">ADD TASK</button>
        </div>
    </div>

    <ul id="todo-list">
        <!-- Tasks will appear here -->
    </ul>

    <script>
        // 1. Initialize State
        let tasks = JSON.parse(localStorage.getItem('myTasks')) || [];
        const listEl = document.getElementById('todo-list');
        const glowEl = document.getElementById('bottomGlow');

        // 2. Toggle Popup
        function togglePopup() {
            document.body.classList.toggle('popup-active');
            if(document.body.classList.contains('popup-active')) {
                document.getElementById('taskInput').focus();
                
                // Set default date to today so calendar opens on current month/day
                const today = new Date().toISOString().split('T')[0];
                const dateInput = document.getElementById('dateInput');
                if(!dateInput.value) {
                    dateInput.value = today;
                }
            }
        }

        // 3. Render List
        function renderTasks() {
            listEl.innerHTML = '';
            
            // Sort: Closest date first
            tasks.sort((a, b) => {
                if (!a.date) return 1;
                if (!b.date) return -1;
                return new Date(a.date) - new Date(b.date);
            });

            // Calculate Load Score for Visual Effects
            let loadScore = 0;
            tasks.forEach(task => {
                if (parseInt(task.size) >= 4) {
                    loadScore += parseInt(task.size);
                }
            });
            updateVisuals(loadScore);

            // Empty State
            if (tasks.length === 0) {
                listEl.innerHTML = `
                    <div class="empty-state">
                        <img src="https://cdn.decrypt.co/wp-content/uploads/2024/11/chillguy-gID_7.jpg" alt="Chill guy">
                        <p>Nothing here, you're all good to chill.</p>
                    </div>`;
                return;
            }

            const todayDate = new Date();
            todayDate.setHours(0,0,0,0);

            // Render Items
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = `todo-item size-${task.size}`;
                li.id = `task-${index}`;
                
                const progressColor = `linear-gradient(90deg, var(--accent) ${task.progress}%, #333 ${task.progress}%)`;
                
                let dateDisplay = '';
                let fontSize = '0.9em'; // Default size

                if (task.date) {
                    const taskDate = new Date(task.date + 'T00:00:00'); 
                    dateDisplay = taskDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

                    // Calculate days difference for font scaling
                    const diffTime = taskDate - todayDate;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    // Scale font based on proximity
                    if (diffDays <= 1) { // Today or past due
                        fontSize = '1.4em';
                    } else if (diffDays <= 3) { // Within 3 days
                        fontSize = '1.2em';
                    } else if (diffDays <= 7) { // Within a week
                        fontSize = '1.0em';
                    }
                }

                // FIX: Input uses class date-input-overlay for better pointer handling
                li.innerHTML = `
                    <div class="todo-header">
                        <span class="todo-title">${task.text}</span>
                        ${dateDisplay ? `
                            <span class="todo-date" style="font-size: ${fontSize}">
                                ${dateDisplay}
                                <input type="date" 
                                       class="date-input-overlay"
                                       onchange="updateDate(${index}, this.value)"
                                       value="${task.date}">
                            </span>
                        ` : ''}
                    </div>
                    <div class="progress-wrapper">
                        <div class="progress-label">${task.progress}% Done</div>
                        <input type="range" 
                               class="progress-slider" 
                               min="0" max="100" 
                               value="${task.progress}" 
                               style="background: ${progressColor}"
                               oninput="updateProgress(${index}, this.value, this)"
                               ontouchstart="event.stopPropagation()">
                    </div>
                `;
                listEl.appendChild(li);
            });
        }

        function updateDate(index, newDate) {
            if (newDate) {
                tasks[index].date = newDate;
                saveAndRender();
            }
        }

        // Handle Visuals (Glow + Background Darkening)
        function updateVisuals(score) {
            if (score < 4) {
                glowEl.style.height = '0';
                glowEl.style.setProperty('--heavy-glow', 'rgba(88, 86, 214, 0)');
                document.body.style.backgroundColor = 'var(--bg-color)'; 
            } else {
                const intensity = Math.min(score / 25, 0.9); 
                const height = Math.min(score * 20, 350); 

                glowEl.style.height = height + 'px';
                glowEl.style.setProperty('--heavy-glow', `rgba(88, 86, 255, ${intensity})`);
                
                if (score > 8) {
                    document.body.style.backgroundColor = '#050505'; 
                } else {
                    document.body.style.backgroundColor = '#0e0e0e';
                }
            }
        }

        // 4. Add Task
        function addTask() {
            const textInput = document.getElementById('taskInput');
            const dateInput = document.getElementById('dateInput');
            const sizeInput = document.getElementById('sizeInput');

            if (textInput.value.trim() === "") {
                textInput.style.borderColor = "var(--error)";
                setTimeout(() => textInput.style.borderColor = "#444", 1500);
                return;
            }

            const newTask = {
                text: textInput.value,
                date: dateInput.value,
                size: sizeInput.value,
                progress: 0
            };

            tasks.push(newTask);
            saveAndRender();
            
            textInput.value = '';
            dateInput.value = new Date().toISOString().split('T')[0];
            sizeInput.value = '1';
            document.getElementById('sizeVal').innerText = '1';
            togglePopup();
        }

        // 5. Update Progress & Confetti
        function updateProgress(index, value, element) {
            tasks[index].progress = value;
            element.style.background = `linear-gradient(90deg, var(--accent) ${value}%, #333 ${value}%)`;
            element.previousElementSibling.innerText = `${value}% Done`;

            if (value == 100) {
                const task = tasks[index];
                const taskItem = document.getElementById(`task-${index}`);
                taskItem.classList.add('completed-anim');
                
                const isBigTask = parseInt(task.size) >= 4;
                spawnConfetti(isBigTask);
                
                if (isBigTask) {
                    spawnFireworks();
                }

                setTimeout(() => {
                    deleteTask(index);
                }, 800);
            } else {
                localStorage.setItem('myTasks', JSON.stringify(tasks));
            }
        }

        // 6. Confetti Logic
        function spawnConfetti(isBig) {
            const count = isBig ? 300 : 50; 
            const colors = isBig 
                ? ['#FFD700', '#E5E4E2', '#ffffff', '#bb86fc', '#5050ff'] 
                : ['#ff0', '#f00', '#0f0', '#00f', '#0ff', '#f0f']; 

            for(let i=0; i<count; i++) {
                const conf = document.createElement('div');
                conf.classList.add('confetti');
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.top = '-10px';
                conf.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                
                const speed = isBig ? (Math.random() * 4 + 2) : (Math.random() * 2 + 1);
                conf.style.animationDuration = speed + 's';
                
                if(isBig) {
                    const size = Math.random() * 8 + 5;
                    conf.style.width = size + 'px';
                    conf.style.height = size + 'px';
                }

                document.body.appendChild(conf);
                setTimeout(() => conf.remove(), speed * 1000);
            }
        }

        // 7. Fireworks Logic (Bombastic Version)
        function spawnFireworks() {
            const colors = ['#FFD700', '#00ff00', '#ff00ff', '#00ffff', '#ffffff', '#ff4500'];
            
            for(let i=0; i<80; i++) {
                createFireworkParticle(0, window.innerHeight, colors);
            }
            
            for(let i=0; i<80; i++) {
                createFireworkParticle(window.innerWidth, window.innerHeight, colors);
            }
        }

        function createFireworkParticle(x, y, colors) {
            const p = document.createElement('div');
            p.classList.add('firework-particle');
            p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            p.style.left = x + 'px';
            p.style.top = y + 'px';

            const xDir = x === 0 ? 1 : -1;
            
            const destX = (Math.random() * 400 + 50) * xDir + 'px';
            const destY = -(Math.random() * 600 + 200) + 'px'; 

            p.style.setProperty('--dx', destX);
            p.style.setProperty('--dy', destY);

            document.body.appendChild(p);
            setTimeout(() => p.remove(), 1000);
        }

        function deleteTask(index) {
            tasks.splice(index, 1);
            saveAndRender();
        }

        function saveAndRender() {
            localStorage.setItem('myTasks', JSON.stringify(tasks));
            renderTasks();
        }

        renderTasks();

    </script>
</body>
</html>
